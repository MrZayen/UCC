<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0 user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>United Cultural Club</title>
  <link rel="stylesheet" href="style.css">
  <style type="text/css" media="all">
    :root{
      --color: #000000;
      --backgroundColor: #FFFFFF;
      --surfaceColor: #F5F5F5;
      --deviderColor: #E8E8E8;
      --avatarColor: #FFFFFF;
    }
    body {
      margin: 0;
      padding: 0;
      font-family: Sans-Serif;
    }
    .activity_main {
      width: 100%;
      height: 100vh;
      color: var(--color);
      fill: var(--color);
      background-color: var(--backgroundColor);
      overflow: scroll;
      scroll-behavior: smooth;
    }
    .activity_main header {
      width: 100%;
      max-width: 600px;
      height: 100px;
      background-color: var(--backgroundColor);
      margin: 0 auto;
      border-bottom: 1px solid var(--deviderColor);
      position: sticky;
      top: -50px;
      user-select: none;
      z-index: 100;
    }
    .activity_main .top-bar {
      width: 100%;
      height: 50px;
      position: relative;
    }
    .activity_main .top-bar__icon {
      width: 35px;
      height: 35px;
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
    }
    .activity_main .tab-bar {
      width: 100%;
      height: 50px;
      display: flex;
    }
    .activity_main .tab-bar__btn {
      flex: 1;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .activity_main .tab-bar__btn-title {
      height: 100%;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .activity_main .tab-bar__btn-title span {
      font-size: 15px;
      font-weight: 420;
    }
    .activity_main .tab-bar__btn.active .tab-bar__btn-title::after {
      content: "";
      width: 100%;
      height: 4px;
      border-radius: 100px;
      background-color: var(--color);
      position: absolute;
      bottom: 0;
    }
    .activity_main .tab-bar__btn.active .tab-bar__btn-title span {}

    .activity_main main {
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
    }
    .activity_main .container {
      width: 100%;
    }
    .activity_main .container .fragment {
      width: 100%;
      animation: transitionIn 0.7s;
      display: none;
    }
    .activity_main .container .fragment.show {
      display: block;
    }


    .card {
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
      user-select: none;
    }
    .card__header {
      width: 100%;
      padding: 15px;
      box-sizing: border-box;
      display: flex;
    }
    .card .header__logo {
      width: 50px;
      height: 50px;
      border-radius: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }
    .card .header__logo img{
      width: 100%;
    }
    .card .header__logo span{
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      color: var(--avatarColor);
      font-size: 25px;
      font-weight: 450;
    }
    .card .header__details {
      flex: 1;
      height: 50px;
      padding-left: 10px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .card__body {
      width: 100%;
      padding: 0 15px;
      box-sizing: border-box;
      display: flex;
    }
    .card__space {
      width: 50px;
      min-height: 100px;
      position: relative;
    }
    .card__space::after {
      content: "";
      width: 3px;
      height: 100%;
      background-color: var(--color);
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
    }
    .card:last-child .card__space::after {
      display: none;
    }
    .card__details {
      flex: 1;
      padding-left: 10px;
    }
    .card__details .details{
      width: 100%;
      padding: 15px;
      box-sizing: border-box;
      border-radius: 10px;
      background-color: var(--surfaceColor);
    }
    .sub-card{
      width: 100%;
    }
    .sub-card__header{
      width: 100%;
      display: flex;
    }
    .sub-card__header__logo{
      width: 50px;
      height: 50px;
      border-radius: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }
    .sub-card__header__logo img{
      width: 100%;
    }
    .sub-card__header__logo span{
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      color: var(--avatarColor);
      font-size: 25px;
      font-weight: 450;
    }
    .sub-card__header__details{
      flex: 1;
      height: 50px;
      padding-left: 10px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .sub-card__body{
      width: 100%;
      height: 50px;
      padding: 10px 0;
      box-sizing: border-box;
    }
    .sub-card__space{
      width: 50px;
      height: 100%;
      position: relative;
    }
    .sub-card__space::after {
      content: "";
      width: 3px;
      height: 100%;
      background-color: var(--color);
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
    }
    .devider{
      width: 100%;
      height: 1px;
      background-color: var(--deviderColor);
      position: fixed;
      bottom: 0;
    }
    
    @keyframes transitionIn{
      from{
        opacity: 0;
        transform: translateY(-4px);
      }
      to{
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @media (prefers-color-scheme: dark) {
      :root{
        --color: #FFFFFF;
        --backgroundColor: #000000;
        --surfaceColor: #252525;
        --deviderColor: #282828;
        --avatarColor: #000000 
      }
    }
  </style>
</head>
<body>
  <div class="activity_main">
    <header>
      <div class="top-bar">
        <div class="top-bar__icon top-bar__btn">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" viewBox="0 0 24 24" style="enable-background:new 0 0 24 24;" xml:space="preserve">
            <path d="M17.523,15.342c-0.552,0-1-0.447-1-0.999s0.447-1,0.999-1c0.552,0,1,0.447,1,0.999  C18.522,14.894,18.075,15.341,17.523,15.342 M6.477,15.342c-0.552,0-1-0.447-1-0.999c0-0.552,0.447-1,0.999-1  c0.552,0,1,0.447,1,0.999C7.476,14.894,7.029,15.341,6.477,15.342 M17.881,9.322l1.997-3.459c0.115-0.199,0.047-0.453-0.152-0.568  c-0.199-0.115-0.453-0.047-0.568,0.152l0,0l-2.022,3.503C15.59,8.244,13.853,7.851,12,7.851S8.41,8.244,6.863,8.949L4.841,5.447  C4.726,5.248,4.472,5.18,4.273,5.294C4.075,5.409,4.006,5.663,4.121,5.862l0,0l1.997,3.46c-3.43,1.865-5.775,5.337-6.119,9.44h24  C23.656,14.659,21.311,11.187,17.881,9.322" />
          </svg>
        </div>
      </div>
      <div class="tab-bar">
        <div class="tab-bar__btn active">
          <div class="tab-bar__btn-title">
            <span>Collections</span>
          </div>
        </div>
        <div class="tab-bar__btn">
          <div class="tab-bar__btn-title">
            <span>Expanses</span>
          </div>
        </div>
      </div>
    </header>
    <main>
      <div class="container">
        <div class="fragment fragment--collections show">
          <div class="default-collection"></div>
        </div>
        <div class="fragment fragment--expanses">
          <div class="default-expanse"></div>
        </div>
      </div>
    </main>
  </div>
  <div class="devider"></div>



  <script type="text/javascript" charset="utf-8">

    let activityMain = document.querySelectorAll(".activity_main")[0];
    let topBarBtn = document.querySelectorAll(".top-bar__btn");
    let tabBarBtn = document.querySelectorAll(".tab-bar__btn");
    let tabFragment = document.querySelectorAll(".fragment");
    
    window.addEventListener("load", ()=>{
      document.querySelectorAll(".fragment").forEach((fragment)=>{
        fragment.style.animation = "transitionIn 0.7s";
      });
    })
    
    let activeTabBtn = sessionStorage.getItem("activeTabBtn");
    if (activeTabBtn === null) {
      sessionStorage.setItem("activeTabBtn", "collectionsTabBtn");
      sessionStorage.setItem("collectionsScrollTop", 0);
    }

    topBarBtn.forEach((btn)=> {
      btn.addEventListener("click", ()=> {
        sessionStorage.clear();
        location.reload();
      })
    });

    tabBarBtn.forEach((btn, index)=> {
      btn.addEventListener("click", ()=> {
        if (!btn.classList.contains("active")) {
          tabBarBtn.forEach((btn)=> {
            btn.classList.remove("active");
          });
          btn.classList.add("active");
          tabFragment.forEach((fragment)=> {
            fragment.classList.remove("show");
          });
          tabFragment[index].classList.add("show");

          switch (index) {
            case 0:
              let collectionsScrollTop = sessionStorage.getItem("collectionsScrollTop");
              if (collectionsScrollTop === null) {
                sessionStorage.setItem("collectionsScrollTop", 0);
              }
              sessionStorage.setItem("activeTabBtn", "collectionsTabBtn");
              restoreState(false);
              break;
            case 1:
              let expansesScrollTop = sessionStorage.getItem("expansesScrollTop");
              if (expansesScrollTop === null) {
                sessionStorage.setItem("expansesScrollTop", 0);
              }
              sessionStorage.setItem("activeTabBtn", "expansesTabBtn");
              restoreState(false);
              break;
          };

        } else {};
      });
    });

    activityMain.addEventListener("scroll", (e)=> {
      let activeTabBtn = sessionStorage.getItem("activeTabBtn");
      if (activeTabBtn === "collectionsTabBtn") {
        sessionStorage.setItem("collectionsScrollTop", e.target.scrollTop);
      } else if (activeTabBtn === "expansesTabBtn") {
        sessionStorage.setItem("expansesScrollTop", e.target.scrollTop);
      };
    });

    restoreState(true);

    function restoreState(isFirstTime) {
      let activeTabBtn = sessionStorage.getItem("activeTabBtn");
      let collectionsScrollTop = sessionStorage.getItem("collectionsScrollTop");
      let expansesScrollTop = sessionStorage.getItem("expansesScrollTop");

      if (activeTabBtn === "collectionsTabBtn") {
        if (isFirstTime) {
          tabBarBtn[0].click();
        }
        activityMain.scrollTop = collectionsScrollTop;
      } else if (activeTabBtn === "expansesTabBtn") {
        if (isFirstTime) {
          tabBarBtn[1].click();
        }
        activityMain.scrollTop = expansesScrollTop;
      }
    }
  </script>

  <script type="module" charset="utf-8">
    import collections from "./scripts/collections.js";
    import expenses from "./scripts/expenses.js";

    let defaultCollection = document.querySelector(".default-collection");
    let defaultExpanse = document.querySelector(".default-expanse");

    add("collections", collections);
    add("expenses", expenses)
    
    document.querySelectorAll(".remove").forEach((item)=>{
      item.remove();
    })

    function add(type, cardData) {
      cardData.forEach((cardData)=> {
        
        let subCardData;
        
        if (type === "collections") {
          subCardData = cardData.getCollections;
        } else if (type === "expenses") {
          subCardData = cardData.getExpenses;
        };
        
        const div = document.createElement("div");
        
        subCardData.forEach((subCardData)=> {
            let subCard = document.createElement("div");
            subCard.classList.add("sub-card");
            
            let subCardLogo;
            if(subCardData.getLogoInfo.getType === "image"){
              subCardLogo = `<img src="${subCardData.getLogo}"/>`;
            }else if(subCardData.getLogoInfo.getType === "text"){
              subCardLogo = `<span style="background-color:${subCardData.getLogoInfo.getColor}">${subCardData.getLogo}</span>`;
            };
            
            subCard.innerHTML = `<div class="sub-card__header">
                                   <div class="sub-card__header__logo">${subCardLogo}</div>
                                   <div class="sub-card__header__details">
                                     <div class="sub-card__header__title">
                                       <span>${subCardData.getInformation.getTitle}</span>
                                     </div>
                                     <div class="sub-card__header__title">
                                       <span>${subCardData.getInformation.getAmount}</span>
                                     </div>
                                   </div>
                                 </div>
                                 <div class="sub-card__body ${subCardData.getClasses[2]}">
                                   <div class="sub-card__space"></div>
                                 </div>`;
            div.appendChild(subCard);
          });
        
        let cardLogo;
            if(cardData.getLogoInfo.getType === "image"){
              cardLogo = `<img src="${cardData.getLogo}"/>`;
            }else if(cardData.getLogoInfo.getType === "text"){
              cardLogo = `<span style="background-color:${cardData.getLogoInfo.getColor}">${cardData.getLogo}</span>`;
            };
        
        const card = `<div class="card">
                        <div class="card__header">
                          <div class="header__logo">${cardLogo}</div>
                          <div class="header__details">
                            <div class="header__title">
                              <span>${cardData.getInformation.getDay}</span>
                            </div>
                            <div class="header__description">
                              <span>${cardData.getInformation.getDate}</span>
                            </div>
                          </div>
                        </div>
                        <div class="card__body">
                          <div class="card__space"></div>
                          <div class="card__details">
                            <div class="details">${div.innerHTML}</div>
                          </div>
                        </div>
                      </div>`;

        if (type === "collections") {
          defaultCollection.insertAdjacentHTML("afterEnd", card);
        } else if (type === "expenses") {
          defaultExpanse.insertAdjacentHTML("afterEnd", card);
        };
      });
    }
  </script>

</body>
</html>